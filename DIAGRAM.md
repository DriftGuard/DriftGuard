# DriftGuard System Architecture & API Flow

## ğŸ—ï¸ System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DriftGuard System                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Kubernetes    â”‚    â”‚   Git Repo      â”‚    â”‚   DriftGuard    â”‚            â”‚
â”‚  â”‚   API Server    â”‚    â”‚   (Desired      â”‚    â”‚   Controller    â”‚            â”‚
â”‚  â”‚   (Live State)  â”‚â—„â”€â”€â–ºâ”‚   State)        â”‚â—„â”€â”€â–ºâ”‚   (Core Engine) â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚           â”‚                       â”‚                       â”‚                    â”‚
â”‚           â”‚                       â”‚                       â–¼                    â”‚
â”‚           â”‚                       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚           â”‚                       â”‚              â”‚   Drift         â”‚          â”‚
â”‚           â”‚                       â”‚              â”‚   Detection     â”‚          â”‚
â”‚           â”‚                       â”‚              â”‚   Engine        â”‚          â”‚
â”‚           â”‚                       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚           â”‚                       â”‚                       â”‚                    â”‚
â”‚           â”‚                       â”‚                       â–¼                    â”‚
â”‚           â”‚                       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚           â”‚                       â”‚              â”‚   State         â”‚          â”‚
â”‚           â”‚                       â”‚              â”‚   Tracking      â”‚          â”‚
â”‚           â”‚                       â”‚              â”‚   & Resolution  â”‚          â”‚
â”‚           â”‚                       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚           â”‚                       â”‚                       â”‚                    â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                   â”‚                       â”‚
â”‚                                   â–¼                       â–¼
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        â”‚   MongoDB       â”‚    â”‚   REST API      â”‚
â”‚                        â”‚   (Enhanced     â”‚    â”‚   Server        â”‚
â”‚                        â”‚   Drift Records)â”‚    â”‚   (HTTP/JSON)   â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                   â”‚                       â”‚
â”‚                                   â–¼                       â–¼
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        â”‚   Prometheus    â”‚    â”‚   Health        â”‚
â”‚                        â”‚   Metrics       â”‚    â”‚   Checks        â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Core Monitoring Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Start         â”‚
â”‚   DriftGuard    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Initialize    â”‚
â”‚   Connections   â”‚
â”‚   (K8s, Git,    â”‚
â”‚    MongoDB)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Periodic      â”‚
â”‚   Analysis      â”‚
â”‚   (Every 30s)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Fetch Live    â”‚
â”‚   K8s State     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Fetch Git     â”‚
â”‚   Desired State â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Compare       â”‚
â”‚   States        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Drift         â”‚
â”‚   Detected?     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚           â”‚
    â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   No    â”‚ â”‚   Yes   â”‚
â”‚  Drift  â”‚ â”‚  Drift  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚
     â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update  â”‚ â”‚ Analyze â”‚
â”‚ Record  â”‚ â”‚ Drift   â”‚
â”‚ (No     â”‚ â”‚ Type &  â”‚
â”‚  Drift) â”‚ â”‚ Severityâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚
     â”‚           â–¼
     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    â”‚ Update  â”‚
     â”‚    â”‚ Record  â”‚
     â”‚    â”‚ (Active â”‚
     â”‚    â”‚  Drift) â”‚
     â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”
               â”‚     â”‚
               â–¼     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Store   â”‚ â”‚ Log     â”‚
        â”‚ in      â”‚ â”‚ Drift   â”‚
        â”‚ MongoDB â”‚ â”‚ Event   â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚            â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
                          â”‚    â”‚
                          â–¼    â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Wait    â”‚ â”‚ Update  â”‚
                   â”‚ Next    â”‚ â”‚ Metrics â”‚
                   â”‚ Cycle   â”‚ â”‚ (Prom)  â”‚
                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                        â”‚           â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”
                                    â”‚  â”‚
                                    â–¼  â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ Repeat  â”‚
                             â”‚ Cycle   â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸŒ API Endpoints & Data Flow

### Health & Monitoring APIs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Health & Monitoring APIs                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  GET /health                                                    â”‚
â”‚  â”œâ”€â”€ Response: {"status":"healthy","message":"Service is running"} â”‚
â”‚  â””â”€â”€ Purpose: Basic health check for load balancers            â”‚
â”‚                                                                 â”‚
â”‚  GET /ready                                                     â”‚
â”‚  â”œâ”€â”€ Response: {"status":"ready","message":"All components ready"} â”‚
â”‚  â””â”€â”€ Purpose: Kubernetes readiness probe                       â”‚
â”‚                                                                 â”‚
â”‚  GET /metrics                                                   â”‚
â”‚  â”œâ”€â”€ Response: Prometheus metrics format                       â”‚
â”‚  â””â”€â”€ Purpose: Metrics collection for monitoring                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Drift Detection APIs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Drift Detection APIs                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  GET /api/v1/drift-records                                      â”‚
â”‚  â”œâ”€â”€ Query Params: namespace, drift_detected                    â”‚
â”‚  â”œâ”€â”€ Response: {"drift_records":[...],"count":N}               â”‚
â”‚  â””â”€â”€ Purpose: List all drift records with filtering            â”‚
â”‚                                                                 â”‚
â”‚  GET /api/v1/drift-records/:resourceId                         â”‚
â”‚  â”œâ”€â”€ Params: resourceId (format: Kind:namespace:name)          â”‚
â”‚  â”œâ”€â”€ Response: Single drift record object                      â”‚
â”‚  â””â”€â”€ Purpose: Get specific resource drift details              â”‚
â”‚                                                                 â”‚
â”‚  GET /api/v1/drift-records/active                              â”‚
â”‚  â”œâ”€â”€ Response: {"drift_records":[...],"count":N}               â”‚
â”‚  â””â”€â”€ Purpose: Get currently active drift records               â”‚
â”‚                                                                 â”‚
â”‚  GET /api/v1/drift-records/resolved                            â”‚
â”‚  â”œâ”€â”€ Response: {"drift_records":[...],"count":N}               â”‚
â”‚  â””â”€â”€ Purpose: Get resolved drift records                       â”‚
â”‚                                                                 â”‚
â”‚  GET /api/v1/statistics                                         â”‚
â”‚  â”œâ”€â”€ Response: {"statistics":{...}}                            â”‚
â”‚  â””â”€â”€ Purpose: Get comprehensive drift statistics               â”‚
â”‚                                                                 â”‚
â”‚  POST /api/v1/analyze                                           â”‚
â”‚  â”œâ”€â”€ Response: {"message":"Analysis triggered","status":"started"} â”‚
â”‚  â””â”€â”€ Purpose: Trigger manual drift analysis                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow Diagrams

### Drift Detection Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚    â”‚   DriftGuardâ”‚    â”‚   MongoDB   â”‚
â”‚   Request   â”‚    â”‚   API       â”‚    â”‚   Database  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚
       â”‚ GET /api/v1/     â”‚                  â”‚
       â”‚ drift-records    â”‚                  â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚
       â”‚                  â”‚                  â”‚
       â”‚                  â”‚ Query drift      â”‚
       â”‚                  â”‚ records          â”‚
       â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                  â”‚                  â”‚
       â”‚                  â”‚ Return records   â”‚
       â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                  â”‚                  â”‚
       â”‚ Return JSON      â”‚                  â”‚
       â”‚ response         â”‚                  â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
       â”‚                  â”‚                  â”‚
```

### Drift Analysis Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚    â”‚   DriftGuardâ”‚    â”‚ Kubernetes  â”‚    â”‚   Git Repo  â”‚
â”‚   Request   â”‚    â”‚   Controllerâ”‚    â”‚   API       â”‚    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚ POST /api/v1/    â”‚                  â”‚                  â”‚
       â”‚ analyze          â”‚                  â”‚                  â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚ Get live state   â”‚                  â”‚
       â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚ Return live      â”‚                  â”‚
       â”‚                  â”‚ state            â”‚                  â”‚
       â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚ Get desired      â”‚                  â”‚
       â”‚                  â”‚ state            â”‚                  â”‚
       â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚ Return desired   â”‚                  â”‚
       â”‚                  â”‚ state            â”‚                  â”‚
       â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚ Compare states   â”‚                  â”‚
       â”‚                  â”‚ & detect drift   â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚ Store results    â”‚                  â”‚
       â”‚                  â”‚ in MongoDB       â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
       â”‚ Return success   â”‚                  â”‚                  â”‚
       â”‚ response         â”‚                  â”‚                  â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚
```

## ğŸ” Drift Detection Logic

### Resource State Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Drift Detection Logic                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Fetch Live State from Kubernetes API                       â”‚
â”‚     â”œâ”€â”€ Deployments, Services, ConfigMaps, Secrets             â”‚
â”‚     â””â”€â”€ Filter by configured namespaces and resource types     â”‚
â”‚                                                                 â”‚
â”‚  2. Fetch Desired State from Git Repository                    â”‚
â”‚     â”œâ”€â”€ Parse YAML manifests from specified branch             â”‚
â”‚     â””â”€â”€ Extract resource definitions                           â”‚
â”‚                                                                 â”‚
â”‚  3. Compare States for Each Resource                           â”‚
â”‚     â”œâ”€â”€ Generate hash of live state                            â”‚
â”‚     â”œâ”€â”€ Generate hash of desired state                         â”‚
â”‚     â””â”€â”€ Compare hashes for equality                            â”‚
â”‚                                                                 â”‚
â”‚  4. If Hashes Differ - Deep Analysis                           â”‚
â”‚     â”œâ”€â”€ Field-by-field comparison                              â”‚
â”‚     â”œâ”€â”€ Classify drift type (Scaling, VersionChange, etc.)     â”‚
â”‚     â”œâ”€â”€ Assign severity level (Low, Medium, High)              â”‚
â”‚     â””â”€â”€ Generate detailed drift report                         â”‚
â”‚                                                                 â”‚
â”‚  5. Update Drift Record                                        â”‚
â”‚     â”œâ”€â”€ Set drift_status: "active" or "resolved"               â”‚
â”‚     â”œâ”€â”€ Update timestamps (first_detected, resolved_at)        â”‚
â”‚     â”œâ”€â”€ Store drift details and resolution message             â”‚
â”‚     â””â”€â”€ Update last_known_good_hash                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Drift Classification Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Drift Classification                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Drift Type          â”‚ Severity â”‚ Examples                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Scaling             â”‚ Medium   â”‚ Replica count changes        â”‚
â”‚  VersionChange       â”‚ High     â”‚ Container image updates      â”‚
â”‚  ResourceChange      â”‚ Medium   â”‚ CPU/memory modifications     â”‚
â”‚  ConfigurationChange â”‚ Medium   â”‚ Environment variables        â”‚
â”‚  LabelChange         â”‚ Low      â”‚ Label additions/removals     â”‚
â”‚  AnnotationChange    â”‚ Low      â”‚ Annotation modifications     â”‚
â”‚  PortChange          â”‚ Medium   â”‚ Port configuration changes   â”‚
â”‚  VolumeChange        â”‚ Medium   â”‚ Volume mount modifications   â”‚
â”‚  SecretChange        â”‚ High     â”‚ Secret reference changes     â”‚
â”‚  ConfigMapChange     â”‚ Medium   â”‚ ConfigMap reference changes  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ State Transition Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Initial       â”‚
â”‚   State         â”‚
â”‚   (No Drift)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Monitor       â”‚
â”‚   Resource      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Drift         â”‚
â”‚   Detected?     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚           â”‚
    â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   No    â”‚ â”‚   Yes   â”‚
â”‚  Drift  â”‚ â”‚  Drift  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚
     â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update  â”‚ â”‚ Set     â”‚
â”‚ Status: â”‚ â”‚ Status: â”‚
â”‚ "none"  â”‚ â”‚ "active"â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚
     â”‚           â–¼
     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    â”‚ Log     â”‚
     â”‚    â”‚ Drift   â”‚
     â”‚    â”‚ Event   â”‚
     â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”
               â”‚     â”‚
               â–¼     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Continueâ”‚ â”‚ Monitor â”‚
        â”‚ Monitor â”‚ â”‚ for     â”‚
        â”‚         â”‚ â”‚ Resolution â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚            â”‚
             â”‚            â–¼
             â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚    â”‚ Drift   â”‚
             â”‚    â”‚ Resolvedâ”‚
             â”‚    â”‚ ?       â”‚
             â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚         â”‚
             â”‚    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
             â”‚    â”‚           â”‚
             â”‚    â–¼           â–¼
             â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ â”‚   No    â”‚ â”‚   Yes   â”‚
             â”‚ â”‚ Continueâ”‚ â”‚ Set     â”‚
             â”‚ â”‚ Monitor â”‚ â”‚ Status: â”‚
             â”‚ â”‚         â”‚ â”‚ "resolved" â”‚
             â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚      â”‚           â”‚
             â”‚      â”‚           â–¼
             â”‚      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚      â”‚    â”‚ Log     â”‚
             â”‚      â”‚    â”‚ Resolution â”‚
             â”‚      â”‚    â”‚ Event   â”‚
             â”‚      â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚      â”‚         â”‚
             â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”
                    â”‚         â”‚     â”‚
                    â–¼         â–¼     â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ Return  â”‚ â”‚ Update  â”‚ â”‚ Continueâ”‚
             â”‚ to      â”‚ â”‚ Record  â”‚ â”‚ Monitor â”‚
             â”‚ Normal  â”‚ â”‚ with    â”‚ â”‚         â”‚
             â”‚ State   â”‚ â”‚ Resolution â”‚         â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ User Interaction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    User Interaction Flow                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Setup & Installation                                        â”‚
â”‚     â”œâ”€â”€ Install prerequisites (Go, MongoDB, kubectl)           â”‚
â”‚     â”œâ”€â”€ Configure DriftGuard (config.yaml)                     â”‚
â”‚     â”œâ”€â”€ Start MongoDB and DriftGuard                           â”‚
â”‚     â””â”€â”€ Verify system health (/health endpoint)                â”‚
â”‚                                                                 â”‚
â”‚  2. Initial Deployment                                          â”‚
â”‚     â”œâ”€â”€ Create test Git repository with K8s manifests          â”‚
â”‚     â”œâ”€â”€ Deploy resources to Kubernetes cluster                 â”‚
â”‚     â”œâ”€â”€ Trigger initial drift analysis                         â”‚
â”‚     â””â”€â”€ Verify no drift detected                               â”‚
â”‚                                                                 â”‚
â”‚  3. Create Test Drift                                           â”‚
â”‚     â”œâ”€â”€ Modify live resources (scale, change image, etc.)      â”‚
â”‚     â”œâ”€â”€ Trigger drift analysis                                 â”‚
â”‚     â”œâ”€â”€ Check active drift records                             â”‚
â”‚     â””â”€â”€ Verify drift detection and classification              â”‚
â”‚                                                                 â”‚
â”‚  4. Resolve Drift                                               â”‚
â”‚     â”œâ”€â”€ Revert changes or apply Git manifests                  â”‚
â”‚     â”œâ”€â”€ Trigger drift analysis                                 â”‚
â”‚     â”œâ”€â”€ Check resolved drift records                           â”‚
â”‚     â””â”€â”€ Verify resolution detection                            â”‚
â”‚                                                                 â”‚
â”‚  5. Monitor & Analyze                                           â”‚
â”‚     â”œâ”€â”€ Check statistics endpoint                              â”‚
â”‚     â”œâ”€â”€ Monitor Prometheus metrics                             â”‚
â”‚     â”œâ”€â”€ Set up alerts and dashboards                           â”‚
â”‚     â””â”€â”€ Review drift patterns and trends                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ Configuration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Configuration Flow                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Server Configuration                                        â”‚
â”‚     â”œâ”€â”€ Port: 8080                                             â”‚
â”‚     â”œâ”€â”€ Timeouts: read/write/idle                              â”‚
â”‚     â””â”€â”€ Logging levels                                         â”‚
â”‚                                                                 â”‚
â”‚  2. Database Configuration                                      â”‚
â”‚     â”œâ”€â”€ MongoDB host and port                                  â”‚
â”‚     â”œâ”€â”€ Database name                                          â”‚
â”‚     â””â”€â”€ Connection timeout                                     â”‚
â”‚                                                                 â”‚
â”‚  3. Kubernetes Configuration                                    â”‚
â”‚     â”œâ”€â”€ Kubeconfig path                                        â”‚
â”‚     â”œâ”€â”€ Context selection                                       â”‚
â”‚     â”œâ”€â”€ Namespaces to monitor                                  â”‚
â”‚     â”œâ”€â”€ Resource types to watch                                â”‚
â”‚     â””â”€â”€ System namespace filtering                             â”‚
â”‚                                                                 â”‚
â”‚  4. Git Configuration                                           â”‚
â”‚     â”œâ”€â”€ Repository URL                                         â”‚
â”‚     â”œâ”€â”€ Default branch                                         â”‚
â”‚     â”œâ”€â”€ Clone and pull timeouts                                â”‚
â”‚     â””â”€â”€ Authentication (if needed)                             â”‚
â”‚                                                                 â”‚
â”‚  5. Drift Detection Configuration                               â”‚
â”‚     â”œâ”€â”€ Analysis interval                                       â”‚
â”‚     â”œâ”€â”€ Periodic detection enable/disable                      â”‚
â”‚     â””â”€â”€ Drift classification rules                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Metrics & Monitoring

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Metrics & Monitoring                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Prometheus Metrics                                             â”‚
â”‚  â”œâ”€â”€ driftguard_drift_events_total                             â”‚
â”‚  â”œâ”€â”€ driftguard_resources_watched                              â”‚
â”‚  â”œâ”€â”€ driftguard_drift_score                                    â”‚
â”‚  â”œâ”€â”€ driftguard_sync_duration_seconds                          â”‚
â”‚  â””â”€â”€ driftguard_api_request_duration_seconds                   â”‚
â”‚                                                                 â”‚
â”‚  Health Checks                                                  â”‚
â”‚  â”œâ”€â”€ /health - Basic service health                            â”‚
â”‚  â”œâ”€â”€ /ready - Kubernetes readiness probe                       â”‚
â”‚  â””â”€â”€ /metrics - Prometheus metrics endpoint                    â”‚
â”‚                                                                 â”‚
â”‚  Logging                                                        â”‚
â”‚  â”œâ”€â”€ Structured JSON logging                                   â”‚
â”‚  â”œâ”€â”€ Emoji indicators for events                               â”‚
â”‚  â”œâ”€â”€ Drift detection events                                    â”‚
â”‚  â”œâ”€â”€ Resolution events                                         â”‚
â”‚  â””â”€â”€ System health events                                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
